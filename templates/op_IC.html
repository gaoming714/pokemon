<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" />

  <!-- <semantic CSS> -->
  <link href="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.5.0/semantic.min.css" rel="stylesheet" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">
  <!-- Main CSS -->
  <link href="{{ url_for('static', filename='preloader.css') }}" rel="stylesheet" />

  <!-- vue -->
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.2.47/vue.global.min.js"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.3.6/axios.min.js"></script>

  <!-- Analytics_baidu -->
  <script src="{{ url_for('static', filename='Analytics_baidu.js') }}"></script>

  <title>Shadow IO PCR</title>
</head>

<body>
  <div class="container" id="app">
    <nav class="navbar navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img src="https://github.githubassets.com/images/modules/site/home/logos/platform-linux.svg" />
          Shadow IO PCR
        </a>
        <!-- <div class="ui labeled button" tabindex="0">
          <div class="ui red button">
            <i class="heart icon"></i> Like
          </div>
          <a class="ui basic red left pointing label">
            1,048
          </a>
        </div> -->
        <div class="ui labeled button" tabindex="0">
          <div class="ui basic blue button">
            <i class="fork icon"></i> Forks
          </div>
          <a class="ui basic left pointing blue label"
            href="http://quote.eastmoney.com/center/gridlist.html#options_sahs300etf_txbj">
            510500
          </a>
        </div>
      </div>
    </nav>
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="card-header">Blend oil</div>
          <div class="card-body">
            <h3 v-text="berry_500"></h3>
            <div class="progress" style="height: 27px">
              <div class="progress-bar" role="progressbar" v-bind:aria-valuenow="berry_500" aria-valuemin="0"
                aria-valuemax="100" v-text="berry_500" :style="{width: berry_500+'%'}"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card">
          <div class="card-header">510500 (70 -90- 110)</div>
          <div class="card-body">
            <h3 v-text="pcr_500"></h3>
            <div class="progress" style="height: 27px">
              <div class="progress-bar" role="progressbar" v-bind:aria-valuenow="berry_500" aria-valuemin="0"
                aria-valuemax="100" v-text="pcr_500" :style="{width: berry_500+'%'}"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <p></p>

    <div class="ui icon message">
      <i class="notched circle loading icon"></i>
      <div class="content">
        <div class="header">current: <span v-text="now"></span></div>
        <p>Refresh every 10s during market opening.</p>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <div ref="chart" style="width: 100%; height: 400px"></div>
      </div>
    </div>
    <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasBottom"
      aria-controls="offcanvasBottom">
      Toggle bottom offcanvas
    </button>

    <div class="offcanvas offcanvas-bottom" tabindex="-1" id="offcanvasBottom" aria-labelledby="offcanvasBottomLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasBottomLabel">
          Offcanvas bottom
        </h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body small">
        <h3>For 510050, 100% is high, 80% is mid, 60% is low.</h3>
        <h3>For 510500, 110% is high, 90% is mid, 70% is low.</h3>
      </div>
    </div>
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
      <div class="col-md-4 d-flex align-items-center">
        <a href="/" class="mb-3 me-2 mb-md-0 text-muted text-decoration-none lh-1">
        </a>
        <span class="text-muted"><i class="closed captioning icon"></i>Email:
          gaoming714@126.com</span>
      </div>

      <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
        <li class="ms-3">
          <a class="text-muted" href="#"><svg class="bi" width="24" height="24">
              <use xlink:href="#twitter"></use>
            </svg></a>
        </li>
        <li class="ms-3">
          <a class="text-muted" href="#"><svg class="bi" width="24" height="24">
              <use xlink:href="#instagram"></use>
            </svg></a>
        </li>
        <li class="ms-3">
          <a class="text-muted" href="#"><svg class="bi" width="24" height="24">
              <use xlink:href="#facebook"></use>
            </svg></a>
        </li>
      </ul>
    </footer>
  </div>
  <!-- Option 1: Bootstrap Bundle with Popper -->
  <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>

  <!-- Option 2: Separate Popper and Bootstrap JS -->
  <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->
  <!-- <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script> -->
  <!-- <script src="https://cdn.bootcdn.net/ajax/libs/semantic-ui/2.5.0/semantic.min.js"></script> -->
  <!-- <script src="{{ url_for('static', filename='semantic/semantic.min.js') }}"></script> -->

  <!-- preloader need -->
  <script src="https://cdn.bootcdn.net/ajax/libs/vivus/0.4.6/vivus.min.js"></script>

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5.2.2/dist/echarts.min.js"></script>
  <script type="text/javascript">
    console.log("well done");
  </script>

  <script type="text/javascript">
    const App = {
      data() {
        return {
          timer: -5,
          pcr_500: 0,
          berry_500: 0,
          berry_500_list: [],
          now: null,
          now_list: [],
          readme: null,
          chartdata: [],
          chartdatax: [],
          chartdatay: [],
        };
      },
      created() { },
      mounted() {
        this.fetch();
        this.refresh();
        // console.log(this.timer);
        setInterval(() => {
          if (this.timer == -5) {
            this.fetch();
            this.refresh();
          }
          this.timer--;
        }, 1000);
        this.getEchart();
      },
      methods: {
        fetch() {
          that = this;
          axios
            .get("/api/remain")
            .then(function (response) {
              // console.log(this.timer);
              // console.log(response);
              that.timer = response.data;
            })
            .catch(function (error) {
              console.log(error);
            })
            .then(function () { });
        },
        refresh() {
          that = this;
          axios
            .get("/api/op")
            .then(function (response) {
              console.log(response);
              that.pcr_500 = response.data["pcr_500"];
              that.berry_500 = response.data["berry_500"];
              that.now = response.data["now"];
              that.now_list = response.data["now_list"]
              that.berry_500_list = response.data["berry_500_list"]
              that.pushdata();
            })
            .catch(function (error) {
              console.log(error);
            })
            .then(function () { });
        },
        pushdata() {
          // this.chartdatax.push(this.now);
          // this.chartdatay.push(Number(this.pretty_500));
          this.chartdatax = that.now_list
          this.chartdatay = that.berry_500_list
          console.log(this.chartdatax);
          console.log(this.chartdatay);
          this.getEchart();
        },
        getEchart() {
          const chart = this.$refs.chart;
          if (chart) {
            // console.log(echarts);
            // console.log(this.$echarts);
            const myChart = echarts.init(chart);
            const option = {
              tooltip: {
                trigger: "axis",
              },
              xAxis: {
                type: "category",
                data: this.chartdatax,
              },
              yAxis: {
                type: "value",
                scale: true,
                min: this.berry_500 + 4,
                max: this.berry_500 - 4,
              },
              series: [
                {
                  data: this.chartdatay,
                  type: "line",
                  smooth: true,

                }],
            };

            myChart.setOption(option);
            window.addEventListener("resize", function () {
              myChart.resize();
            });
          }
        },
      },
    };
    Vue.createApp(App).mount("#app");
  </script>
</body>

</html>